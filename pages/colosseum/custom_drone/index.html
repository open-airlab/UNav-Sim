<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>AirLib on a Real Drone - AirSim</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "AirLib on a Real Drone";
        var mkdocs_page_input_path = "pages/colosseum/custom_drone.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AirSim
        </a>
        <div class="version">
          master
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../README.md">Home</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="" href="../../../CHANGELOG.md">Changelog</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Building AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../use_precompiled.md">Download Binaries</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_windows.md">Build on Windows</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_linux.md">Build on Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_macos.md">Build on macOS</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../docker_ubuntu.md">Docker on Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../azure.md">AirSim on Azure</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unreal_custenv.md">Custom Unreal Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../Unity.md">AirSim with Unity</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../custom_unity_environments.md">Custom Unity Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unity_api_support.md">Unity APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../build_faq.md">FAQ</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Using AirSim</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../apis.md">Core APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../image_apis.md">Image APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../apis_cpp.md">C++ APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api_docs/html/">API Reference Docs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../dev_workflow.md">Development Workflow</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../settings.md">Settings</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../camera_views.md">Camera Views</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../using_car.md">Car Mode</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../remote_control.md">Remote Control</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../xbox_controller.md">XBox Controller</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../steering_wheel_installation.md">Steering Wheel</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../multi_vehicle.md">Multiple Vehicles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Sensors</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../../sensors.md">Sensors</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../lidar.md">LIDAR</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../distance_sensor.md">Distance Sensor</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../InfraredCamera.md">Infrared Camera</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../airsim_ros_pkgs.md">ROS: AirSim ROS Wrapper</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../airsim_tutorial_pkgs.md">ROS: AirSim Tutorial Packages</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../gazebo_drone.md">Import Gazebo models</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../retexturing.md">Domain Randomization</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../meshes.md">Mesh Vertex Buffers</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../playback.md">Playing Logs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../voxel_grid.md">Voxel Grid Generator</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../event_sim.md">Event camera</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Design</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../design.md">Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../code_structure.md">Code Structure</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../adding_new_apis.md">Adding new APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../modify_recording_data.md">Modifying Recording Data</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../coding_guidelines.md">Coding Guidelines</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../flight_controller.md">Flight Controller</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../simple_flight.md">Simple Flight</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../hello_drone.md">Hello Drone</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">External Flight Controllers</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="#">MavLink and PX4</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../../../px4_setup.md">PX4 Setup for AirSim</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_sitl.md">PX4 in SITL</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_sitl_wsl2.md">PX4 SITL with WSL 2</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_lockstep.md">PX4 Lockstep</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_multi_vehicle.md">PX4 Multi-vehicle in SITL</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/1oY8Qu5maQQ">AirSim with Pixhawk</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://youtu.be/HNWdYrtw3f0">PX4 Setup with AirSim</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://www.youtube.com/watch?v=d_FyjKDWQfc&feature=youtu.be">Debugging Attitude Estimation</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Intercepting-MavLink-messages">Intercepting MavLink Messages</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://github.com/Microsoft/AirSim/wiki/Rapid-Descent-on-PX4-drones">Rapid Descent on PX4 Drones</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_build.md">Building PX4</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../px4_logging.md">PX4/MavLink Logging</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../log_viewer.md">MavLink LogViewer</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../mavlinkcom.md">MavLinkCom</a>
                </li>
                <li class="toctree-l2"><a class="" href="../../../mavlinkcom_mocap.md">MavLink MoCap</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ArduPilot</a>
    <ul>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/building-the-code.html">ArduPilot SITL Setup</a>
                </li>
                <li class="toctree-l2"><a class="" href="https://ardupilot.org/dev/docs/sitl-with-airsim.html">AirSim & ArduPilot</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Upgrading</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../unreal_upgrade.md">Upgrading Unreal</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../upgrade_apis.md">Upgrading APIs</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../upgrade_settings.md">Upgrading Settings</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Contributed Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../reinforcement_learning.md">Reinforcement Learning</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://www.youtube.com/watch?v=y09VbdQWvQY">Using Environments from Marketplace</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/simondlevy/AirSimTensorFlow">Simple Collision Avoidance</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://aka.ms/AutonomousDrivingCookbook">Autonomous Driving on Azure</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/hexacopter">Building Hexacopter</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/moveOnPath-demo">Moving on Path Demo</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../point_clouds.md">Building Point Clouds</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../drone_survey.md">Surveying Using Drone</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../orbit.md">Orbit Trajectory</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/Bp86WiLUC80">Importing a custom multirotor mesh</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../object_detection.md">Object Detection</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://youtu.be/ZonkdMcwXH4">AirSim with MAVROS and PX4</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Misc</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../custom_drone.md">AirSim on Real Drones</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../cmake_linux.md">Installing cmake on Linux</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../hard_drive.md">Tips for Busy HDD</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../pfm.md">pfm format</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unreal_proj.md">Setting up Unreal Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../unreal_blocks.md">Blocks Environment</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../who_is_using.md">Who is Using AirSim</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../working_with_plugin_contents.md">Working with UE Plugin Contents</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/Microsoft/AirSim/wiki/technion">Formula Student Technion Self-drive</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Support</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../faq.md">FAQ</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../SUPPORT.md">Support</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../create_issue.md">Create Issue</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CONTRIBUTING.md">Contribute</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AirSim</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>AirLib on a Real Drone</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/microsoft/airsim/edit/master/docs/pages/colosseum/custom_drone.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="airlib-on-a-real-drone">AirLib on a Real Drone<a class="headerlink" href="#airlib-on-a-real-drone" title="Permanent link">#</a></h1>
<p>The AirLib library can be compiled and deployed on the companion computer on a real drone. For our testing, we mounted a Gigabyte Brix BXi7-5500 ultra compact PC on the drone connected to the Pixhawk flight controller over USB. The Gigabyte PC is running Ubuntu, so we are able to SSH into it over Wi-Fi: </p>
<p><img alt="Flamewheel" src="images/Flamewheel.png" /></p>
<p>Once connected you can run MavLinkTest with this command line:
<pre class="highlight"><code>MavLinkTest -serial:/dev/ttyACM0,115200 -logdir:. </code></pre>
And this will produce a log file of the flight which can then be used for <a href="../playback/">playback in the simulator</a>.</p>
<p>You can also add <code>-proxy:192.168.1.100:14550</code> to connect MavLinkTest to a remote computer where you can run QGroundControl or our 
<a href="../log_viewer/">PX4 Log Viewer</a> which is another handy way to see what is going on with your drone.</p>
<p>MavLinkTest then has some simple commands for testing your drone, here's a simple example of some commands:</p>
<pre class="highlight"><code>arm
takeoff 5
orbit 10 2</code></pre>
<p>This will arm the drone, takeoff of 5 meters, then do an orbit pattern radius 10 meters, at 2 m/s.
Type '?' to find all available commands.</p>
<p><strong>Note:</strong> Some commands (for example, <code>orbit</code>) are named differently and have different syntax in MavLinkTest and DroneShell (for example, <code>circlebypath -radius 10 -velocity 21</code>).</p>
<p>When you land the drone you can stop MavLinkTest and copy the *.mavlink log file that was generated.</p>
<h1 id="droneserver-and-droneshell">DroneServer and DroneShell<a class="headerlink" href="#droneserver-and-droneshell" title="Permanent link">#</a></h1>
<p>Once you are happy that the MavLinkTest is working, you can also run DroneServer and DroneShell as follows. First, run MavLinkTest with a local proxy to send everything to DroneServer:</p>
<p><pre class="highlight"><code>MavLinkTest -serial:/dev/ttyACM0,115200 -logdir:. -proxy:127.0.0.1:14560</code></pre>
Change ~/Documents/AirSim/settings.json to say "serial":false, because we want DroneServer to look for this UDP connection.</p>
<pre class="highlight"><code>DroneServer 0</code></pre>
<p>Lastly, you can now connect DroneShell to this instance of DroneServer and use the DroneShell commands to fly your drone:</p>
<pre class="highlight"><code>DroneShell
==||=&gt;
        Welcome to DroneShell 1.0.
        Type ? for help.
        Microsoft Research (c) 2016.

Waiting for drone to report a valid GPS location...
==||=&gt; requestcontrol
==||=&gt; arm
==||=&gt; takeoff
==||=&gt; circlebypath -radius 10 -velocity 2</code></pre>
<h2 id="px4-specific-tools">PX4 Specific Tools<a class="headerlink" href="#px4-specific-tools" title="Permanent link">#</a></h2>
<p>You can run the MavlinkCom library and MavLinkTest app to test the connection
between your companion computer and flight controller.  </p>
<h2 id="how-does-this-work">How Does This Work?<a class="headerlink" href="#how-does-this-work" title="Permanent link">#</a></h2>
<p>AirSim uses MavLinkCom component developed by @lovettchris. The MavLinkCom has a proxy architecture where you can open a connection to PX4 either using serial or UDP and then other components share this connection. When PX4 sends MavLink message, all components receive that message. If any component sends a message then it's received by PX4 only. This allows you to connect any number of components to PX4 <a href="https://github.com/microsoft/AirSim/blob/main/AirLib/include/vehicles/multirotor/firmwares/mavlink/MavLinkMultirotorApi.hpp#L600">This code</a> opens a connection for LogViewer and QGC. You can add something more if you like.</p>
<p>If you want to use QGC + AirSim together than you will need QGC to let own the serial port. QGC opens up TCP connection that acts as a proxy so any other component can connect to QGC and send MavLinkMessage to QGC and then QGC forwards that message to PX4. So you tell AirSim to connect to QGC and let QGC own serial port.</p>
<p>For companion board, the way we did it earlier was to have Gigabyte Brix on the drone. This x86 full-fledged computer that will connect to PX4 through USB. We had Ubuntu on Brix and ran <a href="https://github.com/Microsoft/AirSim/tree/main/DroneServer">DroneServer</a>. The DroneServer created an API endpoint that we can talk to via C++ client code (or Python code) and it translated API calls to MavLink messages. That way you can write your code against the same API, test it in the simulator and then run the same code on an actual vehicle. So the companion computer has DroneServer running along with client code. </p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Copyright &copy; 2021 Microsoft Research</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/microsoft/airsim" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
